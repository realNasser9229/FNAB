<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FNAB 3D: THE OVERCOOKED EDITION</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        #hud { position: absolute; top: 20px; right: 20px; color: #fff; text-align: right; font-size: 24px; text-shadow: 2px 2px #000; }
        
        /* Camera Monitor */
        #monitor { 
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 400px; height: 40px; background: rgba(50,50,50,0.8);
            border: 2px solid #666; color: #fff; cursor: pointer; pointer-events: auto;
            display: flex; justify-content: center; align-items: center; transition: 0.3s;
        }
        #monitor:hover { background: #444; height: 60px; }

        #cctv-ui {
            display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.4);
            pointer-events: auto; z-index: 20;
        }
        .cam-map { position: absolute; bottom: 50px; right: 50px; width: 200px; height: 150px; background: rgba(0,255,0,0.1); border: 2px solid #0f0; }
        .cam-btn { width: 50px; height: 30px; background: #000; color: #0f0; border: 1px solid #0f0; cursor: pointer; margin: 5px; }

        canvas { display: block; }
    </style>
</head>
<body>

<div id="ui-layer">
    <div id="hud">
        <div id="time">12:00 AM</div>
        <div id="power">POWER: 100%</div>
    </div>
    
    <div id="monitor" onclick="toggleCCTV()">REBOOT MONITOR</div>

    <div id="cctv-ui">
        <div style="color:#0f0; padding:20px; font-size:20px;">CAM 01 - MAIN HALL</div>
        <div class="cam-map">
            <button class="cam-btn" onclick="switchCam(0)">C1</button>
            <button class="cam-btn" onclick="switchCam(1)">C2</button>
        </div>
    </div>
</div>

<script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
</script>

<script type="module">
    import * as THREE from 'three';

    // --- GAME STATE ---
    let power = 100;
    let time = 0;
    let cctvActive = false;
    let leftDoorClosed = false;
    let rightDoorClosed = false;

    // --- THREE.JS SETUP ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // --- BUILDING THE OFFICE ---
    // Floor
    const floorGeo = new THREE.PlaneGeometry(20, 20);
    const floorMat = new THREE.MeshStandardMaterial({ color: 0x111111 });
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);

    // Walls (Front, Left, Right)
    function createWall(w, h, x, z, ry = 0) {
        const geo = new THREE.BoxGeometry(w, h, 0.5);
        const mat = new THREE.MeshStandardMaterial({ color: 0x222222 });
        const wall = new THREE.Mesh(geo, mat);
        wall.position.set(x, h/2, z);
        wall.rotation.y = ry;
        wall.castShadow = true;
        wall.receiveShadow = true;
        scene.add(wall);
    }
    createWall(10, 8, 0, -5); // Front
    createWall(10, 8, -5, 0, Math.PI / 2); // Left Wall
    createWall(10, 8, 5, 0, Math.PI / 2); // Right Wall

    // Doors (Visual Blocks)
    const doorGeo = new THREE.BoxGeometry(0.2, 8, 4);
    const doorMat = new THREE.MeshStandardMaterial({ color: 0x444444 });
    const leftDoorMesh = new THREE.Mesh(doorGeo, doorMat);
    leftDoorMesh.position.set(-4.8, 12, 0); // Start raised
    scene.add(leftDoorMesh);

    // Lights
    const ambient = new THREE.AmbientLight(0x404040, 0.5); 
    scene.add(ambient);

    const deskLight = new THREE.PointLight(0xffffff, 10, 10);
    deskLight.position.set(0, 3, -2);
    deskLight.castShadow = true;
    scene.add(deskLight);

    const leftHallLight = new THREE.PointLight(0xff0000, 0, 10); // Red light for left
    leftHallLight.position.set(-4, 4, 0);
    scene.add(leftHallLight);

    // --- BANANSKI CHARACTER ---
    const bananskiGeo = new THREE.CylinderGeometry(0.5, 0.5, 3, 32);
    const bananskiMat = new THREE.MeshStandardMaterial({ color: 0xffff00 });
    const bananski = new THREE.Mesh(bananskiGeo, bananskiMat);
    bananski.position.set(-4, 1.5, -8); // Hide him in the dark
    scene.add(bananski);

    camera.position.set(0, 3, 2);
    camera.lookAt(0, 2, -5);

    // --- CONTROLS & INTERACTION ---
    window.addEventListener('keydown', (e) => {
        if(e.key === 'a') toggleDoor('left');
        if(e.key === 'd') toggleDoor('right');
        if(e.key === 's') leftHallLight.intensity = leftHallLight.intensity === 0 ? 50 : 0;
    });

    function toggleDoor(side) {
        if(side === 'left') {
            leftDoorClosed = !leftDoorClosed;
            leftDoorMesh.position.y = leftDoorClosed ? 4 : 12;
        }
        power -= 1;
    }

    window.toggleCCTV = () => {
        cctvActive = !cctvActive;
        document.getElementById('cctv-ui').style.display = cctvActive ? 'block' : 'none';
    };

    // --- ANIMATION LOOP ---
    function animate() {
        requestAnimationFrame(animate);

        // Subtly sway camera for "breathing" effect
        camera.position.x = Math.sin(Date.now() * 0.001) * 0.1;
        camera.position.y = 3 + Math.cos(Date.now() * 0.001) * 0.05;

        // Bananski AI Logic
        let timeFactor = Date.now() * 0.0005;
        if (!cctvActive) {
            // He moves closer when you aren't looking
            bananski.position.z += 0.01;
        }

        if (bananski.position.z > 1 && !leftDoorClosed) {
            // JUMPSCARE
            document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:20%;'>BANANSKI GOT YOU</h1>";
            setTimeout(() => location.reload(), 2000);
        } else if (bananski.position.z > 1 && leftDoorClosed) {
            bananski.position.z = -10; // Reset him
        }

        renderer.render(scene, camera);
    }

    // --- HUD UPDATES ---
    setInterval(() => {
        time++;
        power -= (leftDoorClosed ? 0.5 : 0.1);
        document.getElementById('power').innerText = `POWER: ${Math.floor(power)}%`;
        document.getElementById('time').innerText = `${12 + Math.floor(time/60)}:00 AM`;
    }, 1000);

    animate();

    // Handle Resize
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>
