<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FNAB: Security Breach</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; }
        #overlay { position: absolute; inset: 0; pointer-events: none; z-index: 10; }
        
        /* HUD */
        #hud { position: absolute; top: 20px; right: 20px; color: #fff; text-align: right; pointer-events: none; }
        .stats { font-size: 24px; text-shadow: 2px 2px #000; color: #0f0; }
        
        /* Camera UI */
        #cam-overlay { 
            display: none; position: absolute; inset: 0; background: rgba(0,20,0,0.3);
            border: 20px solid rgba(255,255,255,0.1); pointer-events: auto; z-index: 20;
        }
        .static { position: absolute; inset: 0; background: url('https://media.giphy.com/media/oEI9uBYSzLpBK/giphy.gif'); opacity: 0.1; pointer-events: none; }
        
        #cam-toggle {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 40px; border: 2px solid #fff; color: #fff;
            background: rgba(0,0,0,0.5); cursor: pointer; pointer-events: auto; z-index: 30;
        }

        #jumpscare {
            display: none; position: fixed; inset: 0; background: #000; z-index: 100;
            justify-content: center; align-items: center;
        }
    </style>
</head>
<body>

<div id="overlay">
    <div id="hud">
        <div class="stats" id="time-display">12:00 AM</div>
        <div class="stats" id="power-display">100%</div>
        <div style="font-size: 12px;">USAGE: <span id="usage-display"> > </span></div>
    </div>
    <button id="cam-toggle">MONITOR</button>
</div>

<div id="cam-overlay">
    <div class="static"></div>
    <div style="color: #0f0; padding: 40px;">CAMERA FEED - LIVE</div>
    </div>

<div id="jumpscare">
    <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNHJ5eW84YnZ4YnZ4YnZ4/xT9IgvEOwRzFnyCjZe/giphy.gif" width="100%">
</div>

<script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
</script>

<script type="module">
import * as THREE from 'three';

// --- CONFIG ---
let state = {
    power: 100,
    time: 0,
    usage: 1,
    leftDoor: false,
    rightDoor: false,
    camOpen: false,
    lookX: 0
};

// --- THREE SCENE ---
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);

// --- OFFICE GEOMETRY ---
const officeGroup = new THREE.Group();

// Dark Industrial Room
const roomGeo = new THREE.BoxGeometry(12, 8, 12);
const roomMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a, side: THREE.BackSide });
const room = new THREE.Mesh(roomGeo, roomMat);
officeGroup.add(room);

// Left & Right Doors (Visuals)
function createDoor(x) {
    const door = new THREE.Mesh(
        new THREE.BoxGeometry(0.5, 7, 3),
        new THREE.MeshStandardMaterial({ color: 0x333333 })
    );
    door.position.set(x, 7, 0); // Start Open (Up)
    return door;
}
const leftDoor = createDoor(-5.8);
const rightDoor = createDoor(5.8);
officeGroup.add(leftDoor, rightDoor);

// Physical Buttons (Clickable)
const btnGeo = new THREE.BoxGeometry(0.2, 0.4, 0.4);
const leftBtn = new THREE.Mesh(btnGeo, new THREE.MeshStandardMaterial({ color: 0xff0000 }));
leftBtn.position.set(-5.7, 0, 2);
leftBtn.name = "left_button";

const rightBtn = new THREE.Mesh(btnGeo, new THREE.MeshStandardMaterial({ color: 0xff0000 }));
rightBtn.position.set(5.7, 0, 2);
rightBtn.name = "right_button";
officeGroup.add(leftBtn, rightBtn);

scene.add(officeGroup);

// --- LIGHTING ---
const ambient = new THREE.AmbientLight(0xffffff, 0.05);
scene.add(ambient);

const deskLight = new THREE.PointLight(0xffffff, 15, 8);
deskLight.position.set(0, 2, -2);
scene.add(deskLight);

// --- INTERACTION ---
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

window.addEventListener('mousedown', (e) => {
    mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    
    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObjects(officeGroup.children);
    
    intersects.forEach(hit => {
        if(hit.object.name === "left_button") toggleDoor('left');
        if(hit.object.name === "right_button") toggleDoor('right');
    });
});

function toggleDoor(side) {
    if(side === 'left') {
        state.leftDoor = !state.leftDoor;
        leftDoor.position.y = state.leftDoor ? 0 : 7;
        leftBtn.material.color.set(state.leftDoor ? 0x00ff00 : 0xff0000);
    } else {
        state.rightDoor = !state.rightDoor;
        rightDoor.position.y = state.rightDoor ? 0 : 7;
        rightBtn.material.color.set(state.rightDoor ? 0x00ff00 : 0xff0000);
    }
    updateUsage();
}

// --- CAMERA PANNING ---
window.addEventListener('mousemove', (e) => {
    state.lookX = (e.clientX / window.innerWidth - 0.5) * 1.5;
});

// --- AI LOGIC ---
let aiPos = 0; // 0: Cam1, 1: Cam2, 2: At Door
setInterval(() => {
    if (Math.random() > 0.7) {
        aiPos++;
        console.log("Something moved. Current Stage: " + aiPos);
        if (aiPos > 2) {
            if (!state.leftDoor) {
                triggerJumpscare();
            } else {
                aiPos = 0; // Reset back to cams
                console.log("Blocked!");
            }
        }
    }
}, 5000);

function triggerJumpscare() {
    document.getElementById('jumpscare').style.display = 'flex';
    setTimeout(() => location.reload(), 2000);
}

// --- GAME LOOP ---
function updateUsage() {
    let u = 1;
    if(state.leftDoor) u++;
    if(state.rightDoor) u++;
    if(state.camOpen) u++;
    state.usage = u;
    document.getElementById('usage-display').innerText = ">".repeat(u);
}

document.getElementById('cam-toggle').onclick = () => {
    state.camOpen = !state.camOpen;
    document.getElementById('cam-overlay').style.display = state.camOpen ? 'block' : 'none';
    updateUsage();
};

function animate() {
    requestAnimationFrame(animate);
    
    // Smooth Look-around
    camera.rotation.y = THREE.MathUtils.lerp(camera.rotation.y, -state.lookX, 0.05);
    
    // Flicker desk light
    if(Math.random() > 0.98) deskLight.intensity = Math.random() * 20;
    else deskLight.intensity = 15;

    renderer.render(scene, camera);
}

setInterval(() => {
    state.time++;
    state.power -= (state.usage * 0.1);
    document.getElementById('power-display').innerText = Math.floor(state.power) + "%";
    document.getElementById('time-display').innerText = (12 + Math.floor(state.time/60)) + ":00 AM";
    if(state.power <= 0) location.reload();
}, 1000);

animate();
</script>
</body>
</html>
